{"ast":null,"code":"var Stream = require('stream').Stream;\n\nvar util = require('util');\n\nmodule.exports = DelayedStream;\n\nfunction DelayedStream() {\n  this.source = null;\n  this.dataSize = 0;\n  this.maxDataSize = 1024 * 1024;\n  this.pauseStream = true;\n  this._maxDataSizeExceeded = false;\n  this._released = false;\n  this._bufferedEvents = [];\n}\n\nutil.inherits(DelayedStream, Stream);\n\nDelayedStream.create = function (source, options) {\n  var delayedStream = new this();\n  options = options || {};\n\n  for (var option in options) {\n    delayedStream[option] = options[option];\n  }\n\n  delayedStream.source = source;\n  var realEmit = source.emit;\n\n  source.emit = function () {\n    delayedStream._handleEmit(arguments);\n\n    return realEmit.apply(source, arguments);\n  };\n\n  source.on('error', function () {});\n\n  if (delayedStream.pauseStream) {\n    source.pause();\n  }\n\n  return delayedStream;\n};\n\nObject.defineProperty(DelayedStream.prototype, 'readable', {\n  configurable: true,\n  enumerable: true,\n  get: function () {\n    return this.source.readable;\n  }\n});\n\nDelayedStream.prototype.setEncoding = function () {\n  return this.source.setEncoding.apply(this.source, arguments);\n};\n\nDelayedStream.prototype.resume = function () {\n  if (!this._released) {\n    this.release();\n  }\n\n  this.source.resume();\n};\n\nDelayedStream.prototype.pause = function () {\n  this.source.pause();\n};\n\nDelayedStream.prototype.release = function () {\n  this._released = true;\n\n  this._bufferedEvents.forEach(function (args) {\n    this.emit.apply(this, args);\n  }.bind(this));\n\n  this._bufferedEvents = [];\n};\n\nDelayedStream.prototype.pipe = function () {\n  var r = Stream.prototype.pipe.apply(this, arguments);\n  this.resume();\n  return r;\n};\n\nDelayedStream.prototype._handleEmit = function (args) {\n  if (this._released) {\n    this.emit.apply(this, args);\n    return;\n  }\n\n  if (args[0] === 'data') {\n    this.dataSize += args[1].length;\n\n    this._checkIfMaxDataSizeExceeded();\n  }\n\n  this._bufferedEvents.push(args);\n};\n\nDelayedStream.prototype._checkIfMaxDataSizeExceeded = function () {\n  if (this._maxDataSizeExceeded) {\n    return;\n  }\n\n  if (this.dataSize <= this.maxDataSize) {\n    return;\n  }\n\n  this._maxDataSizeExceeded = true;\n  var message = 'DelayedStream#maxDataSize of ' + this.maxDataSize + ' bytes exceeded.';\n  this.emit('error', new Error(message));\n};","map":{"version":3,"names":["Stream","require","util","module","exports","DelayedStream","source","dataSize","maxDataSize","pauseStream","_maxDataSizeExceeded","_released","_bufferedEvents","inherits","create","options","delayedStream","option","realEmit","emit","_handleEmit","arguments","apply","on","pause","Object","defineProperty","prototype","configurable","enumerable","get","readable","setEncoding","resume","release","forEach","args","bind","pipe","r","length","_checkIfMaxDataSizeExceeded","push","message","Error"],"sources":["/home/cyrus/WebstormProjects/bigbull/client/node_modules/delayed-stream/lib/delayed_stream.js"],"sourcesContent":["var Stream = require('stream').Stream;\nvar util = require('util');\n\nmodule.exports = DelayedStream;\nfunction DelayedStream() {\n  this.source = null;\n  this.dataSize = 0;\n  this.maxDataSize = 1024 * 1024;\n  this.pauseStream = true;\n\n  this._maxDataSizeExceeded = false;\n  this._released = false;\n  this._bufferedEvents = [];\n}\nutil.inherits(DelayedStream, Stream);\n\nDelayedStream.create = function(source, options) {\n  var delayedStream = new this();\n\n  options = options || {};\n  for (var option in options) {\n    delayedStream[option] = options[option];\n  }\n\n  delayedStream.source = source;\n\n  var realEmit = source.emit;\n  source.emit = function() {\n    delayedStream._handleEmit(arguments);\n    return realEmit.apply(source, arguments);\n  };\n\n  source.on('error', function() {});\n  if (delayedStream.pauseStream) {\n    source.pause();\n  }\n\n  return delayedStream;\n};\n\nObject.defineProperty(DelayedStream.prototype, 'readable', {\n  configurable: true,\n  enumerable: true,\n  get: function() {\n    return this.source.readable;\n  }\n});\n\nDelayedStream.prototype.setEncoding = function() {\n  return this.source.setEncoding.apply(this.source, arguments);\n};\n\nDelayedStream.prototype.resume = function() {\n  if (!this._released) {\n    this.release();\n  }\n\n  this.source.resume();\n};\n\nDelayedStream.prototype.pause = function() {\n  this.source.pause();\n};\n\nDelayedStream.prototype.release = function() {\n  this._released = true;\n\n  this._bufferedEvents.forEach(function(args) {\n    this.emit.apply(this, args);\n  }.bind(this));\n  this._bufferedEvents = [];\n};\n\nDelayedStream.prototype.pipe = function() {\n  var r = Stream.prototype.pipe.apply(this, arguments);\n  this.resume();\n  return r;\n};\n\nDelayedStream.prototype._handleEmit = function(args) {\n  if (this._released) {\n    this.emit.apply(this, args);\n    return;\n  }\n\n  if (args[0] === 'data') {\n    this.dataSize += args[1].length;\n    this._checkIfMaxDataSizeExceeded();\n  }\n\n  this._bufferedEvents.push(args);\n};\n\nDelayedStream.prototype._checkIfMaxDataSizeExceeded = function() {\n  if (this._maxDataSizeExceeded) {\n    return;\n  }\n\n  if (this.dataSize <= this.maxDataSize) {\n    return;\n  }\n\n  this._maxDataSizeExceeded = true;\n  var message =\n    'DelayedStream#maxDataSize of ' + this.maxDataSize + ' bytes exceeded.'\n  this.emit('error', new Error(message));\n};\n"],"mappings":"AAAA,IAAIA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAAP,CAAkBD,MAA/B;;AACA,IAAIE,IAAI,GAAGD,OAAO,CAAC,MAAD,CAAlB;;AAEAE,MAAM,CAACC,OAAP,GAAiBC,aAAjB;;AACA,SAASA,aAAT,GAAyB;EACvB,KAAKC,MAAL,GAAc,IAAd;EACA,KAAKC,QAAL,GAAgB,CAAhB;EACA,KAAKC,WAAL,GAAmB,OAAO,IAA1B;EACA,KAAKC,WAAL,GAAmB,IAAnB;EAEA,KAAKC,oBAAL,GAA4B,KAA5B;EACA,KAAKC,SAAL,GAAiB,KAAjB;EACA,KAAKC,eAAL,GAAuB,EAAvB;AACD;;AACDV,IAAI,CAACW,QAAL,CAAcR,aAAd,EAA6BL,MAA7B;;AAEAK,aAAa,CAACS,MAAd,GAAuB,UAASR,MAAT,EAAiBS,OAAjB,EAA0B;EAC/C,IAAIC,aAAa,GAAG,IAAI,IAAJ,EAApB;EAEAD,OAAO,GAAGA,OAAO,IAAI,EAArB;;EACA,KAAK,IAAIE,MAAT,IAAmBF,OAAnB,EAA4B;IAC1BC,aAAa,CAACC,MAAD,CAAb,GAAwBF,OAAO,CAACE,MAAD,CAA/B;EACD;;EAEDD,aAAa,CAACV,MAAd,GAAuBA,MAAvB;EAEA,IAAIY,QAAQ,GAAGZ,MAAM,CAACa,IAAtB;;EACAb,MAAM,CAACa,IAAP,GAAc,YAAW;IACvBH,aAAa,CAACI,WAAd,CAA0BC,SAA1B;;IACA,OAAOH,QAAQ,CAACI,KAAT,CAAehB,MAAf,EAAuBe,SAAvB,CAAP;EACD,CAHD;;EAKAf,MAAM,CAACiB,EAAP,CAAU,OAAV,EAAmB,YAAW,CAAE,CAAhC;;EACA,IAAIP,aAAa,CAACP,WAAlB,EAA+B;IAC7BH,MAAM,CAACkB,KAAP;EACD;;EAED,OAAOR,aAAP;AACD,CAtBD;;AAwBAS,MAAM,CAACC,cAAP,CAAsBrB,aAAa,CAACsB,SAApC,EAA+C,UAA/C,EAA2D;EACzDC,YAAY,EAAE,IAD2C;EAEzDC,UAAU,EAAE,IAF6C;EAGzDC,GAAG,EAAE,YAAW;IACd,OAAO,KAAKxB,MAAL,CAAYyB,QAAnB;EACD;AALwD,CAA3D;;AAQA1B,aAAa,CAACsB,SAAd,CAAwBK,WAAxB,GAAsC,YAAW;EAC/C,OAAO,KAAK1B,MAAL,CAAY0B,WAAZ,CAAwBV,KAAxB,CAA8B,KAAKhB,MAAnC,EAA2Ce,SAA3C,CAAP;AACD,CAFD;;AAIAhB,aAAa,CAACsB,SAAd,CAAwBM,MAAxB,GAAiC,YAAW;EAC1C,IAAI,CAAC,KAAKtB,SAAV,EAAqB;IACnB,KAAKuB,OAAL;EACD;;EAED,KAAK5B,MAAL,CAAY2B,MAAZ;AACD,CAND;;AAQA5B,aAAa,CAACsB,SAAd,CAAwBH,KAAxB,GAAgC,YAAW;EACzC,KAAKlB,MAAL,CAAYkB,KAAZ;AACD,CAFD;;AAIAnB,aAAa,CAACsB,SAAd,CAAwBO,OAAxB,GAAkC,YAAW;EAC3C,KAAKvB,SAAL,GAAiB,IAAjB;;EAEA,KAAKC,eAAL,CAAqBuB,OAArB,CAA6B,UAASC,IAAT,EAAe;IAC1C,KAAKjB,IAAL,CAAUG,KAAV,CAAgB,IAAhB,EAAsBc,IAAtB;EACD,CAF4B,CAE3BC,IAF2B,CAEtB,IAFsB,CAA7B;;EAGA,KAAKzB,eAAL,GAAuB,EAAvB;AACD,CAPD;;AASAP,aAAa,CAACsB,SAAd,CAAwBW,IAAxB,GAA+B,YAAW;EACxC,IAAIC,CAAC,GAAGvC,MAAM,CAAC2B,SAAP,CAAiBW,IAAjB,CAAsBhB,KAAtB,CAA4B,IAA5B,EAAkCD,SAAlC,CAAR;EACA,KAAKY,MAAL;EACA,OAAOM,CAAP;AACD,CAJD;;AAMAlC,aAAa,CAACsB,SAAd,CAAwBP,WAAxB,GAAsC,UAASgB,IAAT,EAAe;EACnD,IAAI,KAAKzB,SAAT,EAAoB;IAClB,KAAKQ,IAAL,CAAUG,KAAV,CAAgB,IAAhB,EAAsBc,IAAtB;IACA;EACD;;EAED,IAAIA,IAAI,CAAC,CAAD,CAAJ,KAAY,MAAhB,EAAwB;IACtB,KAAK7B,QAAL,IAAiB6B,IAAI,CAAC,CAAD,CAAJ,CAAQI,MAAzB;;IACA,KAAKC,2BAAL;EACD;;EAED,KAAK7B,eAAL,CAAqB8B,IAArB,CAA0BN,IAA1B;AACD,CAZD;;AAcA/B,aAAa,CAACsB,SAAd,CAAwBc,2BAAxB,GAAsD,YAAW;EAC/D,IAAI,KAAK/B,oBAAT,EAA+B;IAC7B;EACD;;EAED,IAAI,KAAKH,QAAL,IAAiB,KAAKC,WAA1B,EAAuC;IACrC;EACD;;EAED,KAAKE,oBAAL,GAA4B,IAA5B;EACA,IAAIiC,OAAO,GACT,kCAAkC,KAAKnC,WAAvC,GAAqD,kBADvD;EAEA,KAAKW,IAAL,CAAU,OAAV,EAAmB,IAAIyB,KAAJ,CAAUD,OAAV,CAAnB;AACD,CAbD"},"metadata":{},"sourceType":"script"}