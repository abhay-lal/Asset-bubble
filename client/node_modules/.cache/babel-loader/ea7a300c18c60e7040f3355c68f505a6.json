{"ast":null,"code":"var util = require('util');\n\nvar Stream = require('stream').Stream;\n\nvar DelayedStream = require('delayed-stream');\n\nmodule.exports = CombinedStream;\n\nfunction CombinedStream() {\n  this.writable = false;\n  this.readable = true;\n  this.dataSize = 0;\n  this.maxDataSize = 2 * 1024 * 1024;\n  this.pauseStreams = true;\n  this._released = false;\n  this._streams = [];\n  this._currentStream = null;\n  this._insideLoop = false;\n  this._pendingNext = false;\n}\n\nutil.inherits(CombinedStream, Stream);\n\nCombinedStream.create = function (options) {\n  var combinedStream = new this();\n  options = options || {};\n\n  for (var option in options) {\n    combinedStream[option] = options[option];\n  }\n\n  return combinedStream;\n};\n\nCombinedStream.isStreamLike = function (stream) {\n  return typeof stream !== 'function' && typeof stream !== 'string' && typeof stream !== 'boolean' && typeof stream !== 'number' && !Buffer.isBuffer(stream);\n};\n\nCombinedStream.prototype.append = function (stream) {\n  var isStreamLike = CombinedStream.isStreamLike(stream);\n\n  if (isStreamLike) {\n    if (!(stream instanceof DelayedStream)) {\n      var newStream = DelayedStream.create(stream, {\n        maxDataSize: Infinity,\n        pauseStream: this.pauseStreams\n      });\n      stream.on('data', this._checkDataSize.bind(this));\n      stream = newStream;\n    }\n\n    this._handleErrors(stream);\n\n    if (this.pauseStreams) {\n      stream.pause();\n    }\n  }\n\n  this._streams.push(stream);\n\n  return this;\n};\n\nCombinedStream.prototype.pipe = function (dest, options) {\n  Stream.prototype.pipe.call(this, dest, options);\n  this.resume();\n  return dest;\n};\n\nCombinedStream.prototype._getNext = function () {\n  this._currentStream = null;\n\n  if (this._insideLoop) {\n    this._pendingNext = true;\n    return; // defer call\n  }\n\n  this._insideLoop = true;\n\n  try {\n    do {\n      this._pendingNext = false;\n\n      this._realGetNext();\n    } while (this._pendingNext);\n  } finally {\n    this._insideLoop = false;\n  }\n};\n\nCombinedStream.prototype._realGetNext = function () {\n  var stream = this._streams.shift();\n\n  if (typeof stream == 'undefined') {\n    this.end();\n    return;\n  }\n\n  if (typeof stream !== 'function') {\n    this._pipeNext(stream);\n\n    return;\n  }\n\n  var getStream = stream;\n  getStream(function (stream) {\n    var isStreamLike = CombinedStream.isStreamLike(stream);\n\n    if (isStreamLike) {\n      stream.on('data', this._checkDataSize.bind(this));\n\n      this._handleErrors(stream);\n    }\n\n    this._pipeNext(stream);\n  }.bind(this));\n};\n\nCombinedStream.prototype._pipeNext = function (stream) {\n  this._currentStream = stream;\n  var isStreamLike = CombinedStream.isStreamLike(stream);\n\n  if (isStreamLike) {\n    stream.on('end', this._getNext.bind(this));\n    stream.pipe(this, {\n      end: false\n    });\n    return;\n  }\n\n  var value = stream;\n  this.write(value);\n\n  this._getNext();\n};\n\nCombinedStream.prototype._handleErrors = function (stream) {\n  var self = this;\n  stream.on('error', function (err) {\n    self._emitError(err);\n  });\n};\n\nCombinedStream.prototype.write = function (data) {\n  this.emit('data', data);\n};\n\nCombinedStream.prototype.pause = function () {\n  if (!this.pauseStreams) {\n    return;\n  }\n\n  if (this.pauseStreams && this._currentStream && typeof this._currentStream.pause == 'function') this._currentStream.pause();\n  this.emit('pause');\n};\n\nCombinedStream.prototype.resume = function () {\n  if (!this._released) {\n    this._released = true;\n    this.writable = true;\n\n    this._getNext();\n  }\n\n  if (this.pauseStreams && this._currentStream && typeof this._currentStream.resume == 'function') this._currentStream.resume();\n  this.emit('resume');\n};\n\nCombinedStream.prototype.end = function () {\n  this._reset();\n\n  this.emit('end');\n};\n\nCombinedStream.prototype.destroy = function () {\n  this._reset();\n\n  this.emit('close');\n};\n\nCombinedStream.prototype._reset = function () {\n  this.writable = false;\n  this._streams = [];\n  this._currentStream = null;\n};\n\nCombinedStream.prototype._checkDataSize = function () {\n  this._updateDataSize();\n\n  if (this.dataSize <= this.maxDataSize) {\n    return;\n  }\n\n  var message = 'DelayedStream#maxDataSize of ' + this.maxDataSize + ' bytes exceeded.';\n\n  this._emitError(new Error(message));\n};\n\nCombinedStream.prototype._updateDataSize = function () {\n  this.dataSize = 0;\n  var self = this;\n\n  this._streams.forEach(function (stream) {\n    if (!stream.dataSize) {\n      return;\n    }\n\n    self.dataSize += stream.dataSize;\n  });\n\n  if (this._currentStream && this._currentStream.dataSize) {\n    this.dataSize += this._currentStream.dataSize;\n  }\n};\n\nCombinedStream.prototype._emitError = function (err) {\n  this._reset();\n\n  this.emit('error', err);\n};","map":{"version":3,"names":["util","require","Stream","DelayedStream","module","exports","CombinedStream","writable","readable","dataSize","maxDataSize","pauseStreams","_released","_streams","_currentStream","_insideLoop","_pendingNext","inherits","create","options","combinedStream","option","isStreamLike","stream","Buffer","isBuffer","prototype","append","newStream","Infinity","pauseStream","on","_checkDataSize","bind","_handleErrors","pause","push","pipe","dest","call","resume","_getNext","_realGetNext","shift","end","_pipeNext","getStream","value","write","self","err","_emitError","data","emit","_reset","destroy","_updateDataSize","message","Error","forEach"],"sources":["/home/cyrus/WebstormProjects/bigbull/client/node_modules/combined-stream/lib/combined_stream.js"],"sourcesContent":["var util = require('util');\nvar Stream = require('stream').Stream;\nvar DelayedStream = require('delayed-stream');\n\nmodule.exports = CombinedStream;\nfunction CombinedStream() {\n  this.writable = false;\n  this.readable = true;\n  this.dataSize = 0;\n  this.maxDataSize = 2 * 1024 * 1024;\n  this.pauseStreams = true;\n\n  this._released = false;\n  this._streams = [];\n  this._currentStream = null;\n  this._insideLoop = false;\n  this._pendingNext = false;\n}\nutil.inherits(CombinedStream, Stream);\n\nCombinedStream.create = function(options) {\n  var combinedStream = new this();\n\n  options = options || {};\n  for (var option in options) {\n    combinedStream[option] = options[option];\n  }\n\n  return combinedStream;\n};\n\nCombinedStream.isStreamLike = function(stream) {\n  return (typeof stream !== 'function')\n    && (typeof stream !== 'string')\n    && (typeof stream !== 'boolean')\n    && (typeof stream !== 'number')\n    && (!Buffer.isBuffer(stream));\n};\n\nCombinedStream.prototype.append = function(stream) {\n  var isStreamLike = CombinedStream.isStreamLike(stream);\n\n  if (isStreamLike) {\n    if (!(stream instanceof DelayedStream)) {\n      var newStream = DelayedStream.create(stream, {\n        maxDataSize: Infinity,\n        pauseStream: this.pauseStreams,\n      });\n      stream.on('data', this._checkDataSize.bind(this));\n      stream = newStream;\n    }\n\n    this._handleErrors(stream);\n\n    if (this.pauseStreams) {\n      stream.pause();\n    }\n  }\n\n  this._streams.push(stream);\n  return this;\n};\n\nCombinedStream.prototype.pipe = function(dest, options) {\n  Stream.prototype.pipe.call(this, dest, options);\n  this.resume();\n  return dest;\n};\n\nCombinedStream.prototype._getNext = function() {\n  this._currentStream = null;\n\n  if (this._insideLoop) {\n    this._pendingNext = true;\n    return; // defer call\n  }\n\n  this._insideLoop = true;\n  try {\n    do {\n      this._pendingNext = false;\n      this._realGetNext();\n    } while (this._pendingNext);\n  } finally {\n    this._insideLoop = false;\n  }\n};\n\nCombinedStream.prototype._realGetNext = function() {\n  var stream = this._streams.shift();\n\n\n  if (typeof stream == 'undefined') {\n    this.end();\n    return;\n  }\n\n  if (typeof stream !== 'function') {\n    this._pipeNext(stream);\n    return;\n  }\n\n  var getStream = stream;\n  getStream(function(stream) {\n    var isStreamLike = CombinedStream.isStreamLike(stream);\n    if (isStreamLike) {\n      stream.on('data', this._checkDataSize.bind(this));\n      this._handleErrors(stream);\n    }\n\n    this._pipeNext(stream);\n  }.bind(this));\n};\n\nCombinedStream.prototype._pipeNext = function(stream) {\n  this._currentStream = stream;\n\n  var isStreamLike = CombinedStream.isStreamLike(stream);\n  if (isStreamLike) {\n    stream.on('end', this._getNext.bind(this));\n    stream.pipe(this, {end: false});\n    return;\n  }\n\n  var value = stream;\n  this.write(value);\n  this._getNext();\n};\n\nCombinedStream.prototype._handleErrors = function(stream) {\n  var self = this;\n  stream.on('error', function(err) {\n    self._emitError(err);\n  });\n};\n\nCombinedStream.prototype.write = function(data) {\n  this.emit('data', data);\n};\n\nCombinedStream.prototype.pause = function() {\n  if (!this.pauseStreams) {\n    return;\n  }\n\n  if(this.pauseStreams && this._currentStream && typeof(this._currentStream.pause) == 'function') this._currentStream.pause();\n  this.emit('pause');\n};\n\nCombinedStream.prototype.resume = function() {\n  if (!this._released) {\n    this._released = true;\n    this.writable = true;\n    this._getNext();\n  }\n\n  if(this.pauseStreams && this._currentStream && typeof(this._currentStream.resume) == 'function') this._currentStream.resume();\n  this.emit('resume');\n};\n\nCombinedStream.prototype.end = function() {\n  this._reset();\n  this.emit('end');\n};\n\nCombinedStream.prototype.destroy = function() {\n  this._reset();\n  this.emit('close');\n};\n\nCombinedStream.prototype._reset = function() {\n  this.writable = false;\n  this._streams = [];\n  this._currentStream = null;\n};\n\nCombinedStream.prototype._checkDataSize = function() {\n  this._updateDataSize();\n  if (this.dataSize <= this.maxDataSize) {\n    return;\n  }\n\n  var message =\n    'DelayedStream#maxDataSize of ' + this.maxDataSize + ' bytes exceeded.';\n  this._emitError(new Error(message));\n};\n\nCombinedStream.prototype._updateDataSize = function() {\n  this.dataSize = 0;\n\n  var self = this;\n  this._streams.forEach(function(stream) {\n    if (!stream.dataSize) {\n      return;\n    }\n\n    self.dataSize += stream.dataSize;\n  });\n\n  if (this._currentStream && this._currentStream.dataSize) {\n    this.dataSize += this._currentStream.dataSize;\n  }\n};\n\nCombinedStream.prototype._emitError = function(err) {\n  this._reset();\n  this.emit('error', err);\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}