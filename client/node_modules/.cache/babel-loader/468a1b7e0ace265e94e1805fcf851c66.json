{"ast":null,"code":"'use strict';\n\nvar crypto = require('crypto');\n\nfunction randomString(size) {\n  var bits = (size + 1) * 6;\n  var buffer = crypto.randomBytes(Math.ceil(bits / 8));\n  var string = buffer.toString('base64').replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '');\n  return string.slice(0, size);\n}\n\nfunction calculatePayloadHash(payload, algorithm, contentType) {\n  var hash = crypto.createHash(algorithm);\n  hash.update('hawk.1.payload\\n');\n  hash.update((contentType ? contentType.split(';')[0].trim().toLowerCase() : '') + '\\n');\n  hash.update(payload || '');\n  hash.update('\\n');\n  return hash.digest('base64');\n}\n\nexports.calculateMac = function (credentials, opts) {\n  var normalized = 'hawk.1.header\\n' + opts.ts + '\\n' + opts.nonce + '\\n' + (opts.method || '').toUpperCase() + '\\n' + opts.resource + '\\n' + opts.host.toLowerCase() + '\\n' + opts.port + '\\n' + (opts.hash || '') + '\\n';\n\n  if (opts.ext) {\n    normalized = normalized + opts.ext.replace('\\\\', '\\\\\\\\').replace('\\n', '\\\\n');\n  }\n\n  normalized = normalized + '\\n';\n\n  if (opts.app) {\n    normalized = normalized + opts.app + '\\n' + (opts.dlg || '') + '\\n';\n  }\n\n  var hmac = crypto.createHmac(credentials.algorithm, credentials.key).update(normalized);\n  var digest = hmac.digest('base64');\n  return digest;\n};\n\nexports.header = function (uri, method, opts) {\n  var timestamp = opts.timestamp || Math.floor((Date.now() + (opts.localtimeOffsetMsec || 0)) / 1000);\n  var credentials = opts.credentials;\n\n  if (!credentials || !credentials.id || !credentials.key || !credentials.algorithm) {\n    return '';\n  }\n\n  if (['sha1', 'sha256'].indexOf(credentials.algorithm) === -1) {\n    return '';\n  }\n\n  var artifacts = {\n    ts: timestamp,\n    nonce: opts.nonce || randomString(6),\n    method: method,\n    resource: uri.pathname + (uri.search || ''),\n    host: uri.hostname,\n    port: uri.port || (uri.protocol === 'http:' ? 80 : 443),\n    hash: opts.hash,\n    ext: opts.ext,\n    app: opts.app,\n    dlg: opts.dlg\n  };\n\n  if (!artifacts.hash && (opts.payload || opts.payload === '')) {\n    artifacts.hash = calculatePayloadHash(opts.payload, credentials.algorithm, opts.contentType);\n  }\n\n  var mac = exports.calculateMac(credentials, artifacts);\n  var hasExt = artifacts.ext !== null && artifacts.ext !== undefined && artifacts.ext !== '';\n  var header = 'Hawk id=\"' + credentials.id + '\", ts=\"' + artifacts.ts + '\", nonce=\"' + artifacts.nonce + (artifacts.hash ? '\", hash=\"' + artifacts.hash : '') + (hasExt ? '\", ext=\"' + artifacts.ext.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"') : '') + '\", mac=\"' + mac + '\"';\n\n  if (artifacts.app) {\n    header = header + ', app=\"' + artifacts.app + (artifacts.dlg ? '\", dlg=\"' + artifacts.dlg : '') + '\"';\n  }\n\n  return header;\n};","map":{"version":3,"names":["crypto","require","randomString","size","bits","buffer","randomBytes","Math","ceil","string","toString","replace","slice","calculatePayloadHash","payload","algorithm","contentType","hash","createHash","update","split","trim","toLowerCase","digest","exports","calculateMac","credentials","opts","normalized","ts","nonce","method","toUpperCase","resource","host","port","ext","app","dlg","hmac","createHmac","key","header","uri","timestamp","floor","Date","now","localtimeOffsetMsec","id","indexOf","artifacts","pathname","search","hostname","protocol","mac","hasExt","undefined"],"sources":["/home/cyrus/WebstormProjects/bigbull/client/node_modules/request/lib/hawk.js"],"sourcesContent":["'use strict'\n\nvar crypto = require('crypto')\n\nfunction randomString (size) {\n  var bits = (size + 1) * 6\n  var buffer = crypto.randomBytes(Math.ceil(bits / 8))\n  var string = buffer.toString('base64').replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '')\n  return string.slice(0, size)\n}\n\nfunction calculatePayloadHash (payload, algorithm, contentType) {\n  var hash = crypto.createHash(algorithm)\n  hash.update('hawk.1.payload\\n')\n  hash.update((contentType ? contentType.split(';')[0].trim().toLowerCase() : '') + '\\n')\n  hash.update(payload || '')\n  hash.update('\\n')\n  return hash.digest('base64')\n}\n\nexports.calculateMac = function (credentials, opts) {\n  var normalized = 'hawk.1.header\\n' +\n    opts.ts + '\\n' +\n    opts.nonce + '\\n' +\n    (opts.method || '').toUpperCase() + '\\n' +\n    opts.resource + '\\n' +\n    opts.host.toLowerCase() + '\\n' +\n    opts.port + '\\n' +\n    (opts.hash || '') + '\\n'\n\n  if (opts.ext) {\n    normalized = normalized + opts.ext.replace('\\\\', '\\\\\\\\').replace('\\n', '\\\\n')\n  }\n\n  normalized = normalized + '\\n'\n\n  if (opts.app) {\n    normalized = normalized + opts.app + '\\n' + (opts.dlg || '') + '\\n'\n  }\n\n  var hmac = crypto.createHmac(credentials.algorithm, credentials.key).update(normalized)\n  var digest = hmac.digest('base64')\n  return digest\n}\n\nexports.header = function (uri, method, opts) {\n  var timestamp = opts.timestamp || Math.floor((Date.now() + (opts.localtimeOffsetMsec || 0)) / 1000)\n  var credentials = opts.credentials\n  if (!credentials || !credentials.id || !credentials.key || !credentials.algorithm) {\n    return ''\n  }\n\n  if (['sha1', 'sha256'].indexOf(credentials.algorithm) === -1) {\n    return ''\n  }\n\n  var artifacts = {\n    ts: timestamp,\n    nonce: opts.nonce || randomString(6),\n    method: method,\n    resource: uri.pathname + (uri.search || ''),\n    host: uri.hostname,\n    port: uri.port || (uri.protocol === 'http:' ? 80 : 443),\n    hash: opts.hash,\n    ext: opts.ext,\n    app: opts.app,\n    dlg: opts.dlg\n  }\n\n  if (!artifacts.hash && (opts.payload || opts.payload === '')) {\n    artifacts.hash = calculatePayloadHash(opts.payload, credentials.algorithm, opts.contentType)\n  }\n\n  var mac = exports.calculateMac(credentials, artifacts)\n\n  var hasExt = artifacts.ext !== null && artifacts.ext !== undefined && artifacts.ext !== ''\n  var header = 'Hawk id=\"' + credentials.id +\n    '\", ts=\"' + artifacts.ts +\n    '\", nonce=\"' + artifacts.nonce +\n    (artifacts.hash ? '\", hash=\"' + artifacts.hash : '') +\n    (hasExt ? '\", ext=\"' + artifacts.ext.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"') : '') +\n    '\", mac=\"' + mac + '\"'\n\n  if (artifacts.app) {\n    header = header + ', app=\"' + artifacts.app + (artifacts.dlg ? '\", dlg=\"' + artifacts.dlg : '') + '\"'\n  }\n\n  return header\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}