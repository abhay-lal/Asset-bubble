{"ast":null,"code":"'use strict';\n\nvar uuid = require('uuid/v4');\n\nvar CombinedStream = require('combined-stream');\n\nvar isstream = require('isstream');\n\nvar Buffer = require('safe-buffer').Buffer;\n\nfunction Multipart(request) {\n  this.request = request;\n  this.boundary = uuid();\n  this.chunked = false;\n  this.body = null;\n}\n\nMultipart.prototype.isChunked = function (options) {\n  var self = this;\n  var chunked = false;\n  var parts = options.data || options;\n\n  if (!parts.forEach) {\n    self.request.emit('error', new Error('Argument error, options.multipart.'));\n  }\n\n  if (options.chunked !== undefined) {\n    chunked = options.chunked;\n  }\n\n  if (self.request.getHeader('transfer-encoding') === 'chunked') {\n    chunked = true;\n  }\n\n  if (!chunked) {\n    parts.forEach(function (part) {\n      if (typeof part.body === 'undefined') {\n        self.request.emit('error', new Error('Body attribute missing in multipart.'));\n      }\n\n      if (isstream(part.body)) {\n        chunked = true;\n      }\n    });\n  }\n\n  return chunked;\n};\n\nMultipart.prototype.setHeaders = function (chunked) {\n  var self = this;\n\n  if (chunked && !self.request.hasHeader('transfer-encoding')) {\n    self.request.setHeader('transfer-encoding', 'chunked');\n  }\n\n  var header = self.request.getHeader('content-type');\n\n  if (!header || header.indexOf('multipart') === -1) {\n    self.request.setHeader('content-type', 'multipart/related; boundary=' + self.boundary);\n  } else {\n    if (header.indexOf('boundary') !== -1) {\n      self.boundary = header.replace(/.*boundary=([^\\s;]+).*/, '$1');\n    } else {\n      self.request.setHeader('content-type', header + '; boundary=' + self.boundary);\n    }\n  }\n};\n\nMultipart.prototype.build = function (parts, chunked) {\n  var self = this;\n  var body = chunked ? new CombinedStream() : [];\n\n  function add(part) {\n    if (typeof part === 'number') {\n      part = part.toString();\n    }\n\n    return chunked ? body.append(part) : body.push(Buffer.from(part));\n  }\n\n  if (self.request.preambleCRLF) {\n    add('\\r\\n');\n  }\n\n  parts.forEach(function (part) {\n    var preamble = '--' + self.boundary + '\\r\\n';\n    Object.keys(part).forEach(function (key) {\n      if (key === 'body') {\n        return;\n      }\n\n      preamble += key + ': ' + part[key] + '\\r\\n';\n    });\n    preamble += '\\r\\n';\n    add(preamble);\n    add(part.body);\n    add('\\r\\n');\n  });\n  add('--' + self.boundary + '--');\n\n  if (self.request.postambleCRLF) {\n    add('\\r\\n');\n  }\n\n  return body;\n};\n\nMultipart.prototype.onRequest = function (options) {\n  var self = this;\n  var chunked = self.isChunked(options);\n  var parts = options.data || options;\n  self.setHeaders(chunked);\n  self.chunked = chunked;\n  self.body = self.build(parts, chunked);\n};\n\nexports.Multipart = Multipart;","map":{"version":3,"names":["uuid","require","CombinedStream","isstream","Buffer","Multipart","request","boundary","chunked","body","prototype","isChunked","options","self","parts","data","forEach","emit","Error","undefined","getHeader","part","setHeaders","hasHeader","setHeader","header","indexOf","replace","build","add","toString","append","push","from","preambleCRLF","preamble","Object","keys","key","postambleCRLF","onRequest","exports"],"sources":["/home/cyrus/WebstormProjects/bigbull/client/node_modules/request/lib/multipart.js"],"sourcesContent":["'use strict'\n\nvar uuid = require('uuid/v4')\nvar CombinedStream = require('combined-stream')\nvar isstream = require('isstream')\nvar Buffer = require('safe-buffer').Buffer\n\nfunction Multipart (request) {\n  this.request = request\n  this.boundary = uuid()\n  this.chunked = false\n  this.body = null\n}\n\nMultipart.prototype.isChunked = function (options) {\n  var self = this\n  var chunked = false\n  var parts = options.data || options\n\n  if (!parts.forEach) {\n    self.request.emit('error', new Error('Argument error, options.multipart.'))\n  }\n\n  if (options.chunked !== undefined) {\n    chunked = options.chunked\n  }\n\n  if (self.request.getHeader('transfer-encoding') === 'chunked') {\n    chunked = true\n  }\n\n  if (!chunked) {\n    parts.forEach(function (part) {\n      if (typeof part.body === 'undefined') {\n        self.request.emit('error', new Error('Body attribute missing in multipart.'))\n      }\n      if (isstream(part.body)) {\n        chunked = true\n      }\n    })\n  }\n\n  return chunked\n}\n\nMultipart.prototype.setHeaders = function (chunked) {\n  var self = this\n\n  if (chunked && !self.request.hasHeader('transfer-encoding')) {\n    self.request.setHeader('transfer-encoding', 'chunked')\n  }\n\n  var header = self.request.getHeader('content-type')\n\n  if (!header || header.indexOf('multipart') === -1) {\n    self.request.setHeader('content-type', 'multipart/related; boundary=' + self.boundary)\n  } else {\n    if (header.indexOf('boundary') !== -1) {\n      self.boundary = header.replace(/.*boundary=([^\\s;]+).*/, '$1')\n    } else {\n      self.request.setHeader('content-type', header + '; boundary=' + self.boundary)\n    }\n  }\n}\n\nMultipart.prototype.build = function (parts, chunked) {\n  var self = this\n  var body = chunked ? new CombinedStream() : []\n\n  function add (part) {\n    if (typeof part === 'number') {\n      part = part.toString()\n    }\n    return chunked ? body.append(part) : body.push(Buffer.from(part))\n  }\n\n  if (self.request.preambleCRLF) {\n    add('\\r\\n')\n  }\n\n  parts.forEach(function (part) {\n    var preamble = '--' + self.boundary + '\\r\\n'\n    Object.keys(part).forEach(function (key) {\n      if (key === 'body') { return }\n      preamble += key + ': ' + part[key] + '\\r\\n'\n    })\n    preamble += '\\r\\n'\n    add(preamble)\n    add(part.body)\n    add('\\r\\n')\n  })\n  add('--' + self.boundary + '--')\n\n  if (self.request.postambleCRLF) {\n    add('\\r\\n')\n  }\n\n  return body\n}\n\nMultipart.prototype.onRequest = function (options) {\n  var self = this\n\n  var chunked = self.isChunked(options)\n  var parts = options.data || options\n\n  self.setHeaders(chunked)\n  self.chunked = chunked\n  self.body = self.build(parts, chunked)\n}\n\nexports.Multipart = Multipart\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}